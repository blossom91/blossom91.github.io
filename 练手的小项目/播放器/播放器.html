<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>播放器</title>
        <style>
            .songListShow {
                color: blue;
            }
        </style>
    </head>
    <body>
        <div class="songList" >
            <ul>

            </ul>
        </div>
        <audio id="audio">
            <source src="">
        </audio>
        <div>
            <span class="currentTime"></span>
            <span class="durationTime"></span>
             进度条<input id="progress" type="range" min="0" step="0.5">
            <br>
            <button class='musicPlay'>播放</button>
            <button class="musicPause">暂停</button>
            <br>
            <button class="musicLeft"><</button>
            <button class="musicRight">></button>
            <br>
            <button class="playWay" type="button" name="button">列表循环</button>
            音量<input id="musicVolume" type="range" max='1' min="0" step="0.0002" value="0.5">
        </div>
        <script>
        //常用函数
        var e = function(element) {
            return document.querySelector(element)
        }

        var es = function(element) {
            return document.querySelectorAll(element)
        }

        var bindEvent = function(element, eventName, callback) {
            element.addEventListener(eventName, callback)
        }

        var bindAll = function(selector, eventName, callback) {
            var elements = document.querySelectorAll(selector)
            for(var i = 0; i < elements.length; i++) {
                var e = elements[i]
                bindEvent(e, eventName, callback)
            }
        }

        //播放方式函数
        var musicdq = function() {
            audio.play()
        }

        var musiclb = function() {
            e('.musicRight').click()
        }

        var musicsj = function() {
            var n = parseInt(Math.random() * 10000) % songs.length
            audio.src = 'music/' + songs[n].src
        }

        var __main = function() {
            //歌曲列表
            var songs = [
                {
                    src : '1.mp3',
                    name : '陈一发儿 - 阿婆说',
                },
                {
                    src : '2.mp3',
                    name : '陈一发儿 - 童话镇',
                },
                {
                    src : '3.mp3',
                    name : '光宗信吉 - I SAY YES(wedding version)',
                },
                {
                    src : '4.mp3',
                    name : '骆集益 - 回梦游仙',
                },
                {
                    src : '5.mp3',
                    name : '骆集益 - 御剑江湖',
                },
                {
                    src : '6.mp3',
                    name : '麦振鸿 - 莫失莫忘',
                },
            ]
            //绑定按钮
            var audio = e('#audio')
            //页面载入初始化
            var musicLoad = function() {
                audio.src = 'music/' + songs[0].src
                audio.volume = 0.5
                bindEvent(audio, 'ended', musiclb)
                //歌单加入页面并绑定切歌功能
                var songList = function(s) {
                    for (var i = 0; i < s.length; i++) {
                        var t =`
                            <li data-name = '${s[i].name}' data-src = '${s[i].src}'>${s[i].name}</li>
                        `
                        e('.songList ul').insertAdjacentHTML('beforeend',t)
                    }
                    bindAll('.songList li','click',function(event) {
                        var self = event.target.dataset.src
                        audio.src = 'music/' + self
                    })
                }
                songList(songs)
            }
            musicLoad()
            //载入后初始化
            bindEvent(audio, 'canplay', function() {
                audio.play()
                e('.durationTime').innerHTML = '/' + parseInt(audio.duration)
                e('#progress').max = parseInt(audio.duration) + ''
                if (e('.songListShow') != null) {
                    e('.songListShow').classList.remove('songListShow')
                }
                for (var i = 0; i < es('.songList li').length; i++) {
                    if (es('.songList li')[i].dataset.src == audio.src.slice(-5)) {
                        es('.songList li')[i].classList.add('songListShow')
                        break
                    }
                }
            })
            //播放
            bindEvent(e('.musicPlay'), 'click', function() {
                audio.play()
            })
            //暂停
            bindEvent(e('.musicPause'), 'click', function() {
                audio.pause()
            })
            // 进度条
            bindEvent(e('#progress'), 'change', function() {
                audio.currentTime = e('#progress').value
            })
            //音量条
            bindEvent(e('#musicVolume'), 'change', function() {
                audio.volume =  e('#musicVolume').value
            })
            //计时器
            bindEvent(audio, 'timeupdate', function() {
                e('.currentTime').innerHTML = parseInt(audio.currentTime)
                e('#progress').value = parseInt(audio.currentTime) + ''
            })
            // 上一首
            bindEvent(e('.musicLeft'), 'click', function() {
                var next = ((parseInt(e('.songListShow').dataset.src.split('.')[0]) - 1) + songs.length - 1)  %  songs.length
                audio.src = 'music/' + songs[next].src

            })
            //下一首
            bindEvent(e('.musicRight'), 'click', function() {
                var next = ((parseInt(e('.songListShow').dataset.src.split('.')[0]) - 1) + songs.length + 1)  %  songs.length
                audio.src = 'music/' + songs[next].src
            })
            //播放方式
            bindEvent(e('.playWay'),'click', function(event) {
                var self = event.target.innerHTML
                if (self == '列表循环') {
                    audio.removeEventListener('ended',musiclb)
                    bindEvent(audio, 'ended', musicdq)
                    e('.playWay').innerHTML = '单曲循环'
                    return
                } else if (self == '单曲循环') {
                    audio.removeEventListener('ended',musicdq)
                    bindEvent(audio, 'ended', musicsj)
                    e('.playWay').innerHTML = '随机循环'
                    return
                } else {
                    audio.removeEventListener('ended',musicsj)
                    bindEvent(audio, 'ended', musiclb)
                    e('.playWay').innerHTML = '列表循环'
                    return
                }
            })
        }
        __main()
        </script>
    </body>
</html>
